<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
  <% if @listing.photos.count > 1 %>
    <% for x in 0..@listing.photos.count %>
      <% break if x == (@listing.photos.count) %>
      <% if x == 0 %>
        <li data-target="#carouselExampleIndicators" data-slide-to="<%= x %>" class="active"></li>
      <% else %>
          <li data-target="#carouselExampleIndicators" data-slide-to="<%= x %>"></li>
      <% end %>
      <% x += 1 %>
      <% end %>
  <% end %>
  </ol>

<div class="carousel-inner" role="listbox">
  <div class="carousel-item active">
    <% if @listing.photos.first %>
      <%= image_tag @listing.photos.first, class: "listing-photo d-block img-fluid"  %>
    <% end %>
  </div>
  <% if @listing.photos.count > 1 %>
    <% @listing.photos.shift %>
    <% @listing.photos.each do |photo| %>
    <div class="carousel-item">
      <%= image_tag photo.url, class: "listing-photo d-block img-fluid"  %>
    </div>
    <% end %>
  <% end %>
</div>
<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
  <span class="sr-only">Previous</span>
</a>
<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
  <span class="carousel-control-next-icon" aria-hidden="true"></span>
  <span class="sr-only">Next</span>
</a>
</div>

<section class="container d-flex align-items-center justify-content-center">
  <div class="row my-5">
    <div class="col-12">
      <h1 class='text-center'><%= @listing.name %></h1>
      <% if current_user.id == @listing.user_id || current_user.super_admin? %>
        <%= link_to 'Edit listing', edit_listing_path(@listing) %>
        <%= link_to 'Delete listing', listing_path(@listing), method: :delete %>
      <% end %>
      <% if !current_user.user? && @listing.verification == false %>
        <%= link_to 'Verify listing', verify_listing_path(@listing), method: :post %>
      <% end %>
    </div>
  </div>
</section>

<main class="container">
  <div class="row">
    <div class="col-8">
      <small>Hosted by:</small>
      <%= link_to user_path(@listing.user) do %>
         <h2><%= @listing.user.full_name %></h2>
      <% end %>

      <h2>Description</h2>
      <%= @listing.description %>
      <dl>
        <dt>Number of Guests</dt>
        <dd><%= @listing.guest_pax %></dd>
        <dt>Number of Bathrooms</dt>
        <dd><%= @listing.bathroom_count %></dd>
        <dt>Number of Bedrooms</dt>
        <dd><%= @listing.bedroom_count %></dd>
        <dt>Price per Night</dt>
        <dd>RM<%= number_with_precision(@listing.price_per_night, precision: 2) %></dd>
      </dl>
      <h3>Tags</h3>
      <p> <%= raw @listing.tag_list.map { |t| link_to t, tag_path(t) }.join(', ') %></p>
    </div>
    <div class="col-4">
      <%= form_for [current_user, @reservation] do |form| %>
      <%= render partial: '/reservations/form', object: form %>
      <%= form.hidden_field :user_id, value: current_user.id %>
      <%= form.hidden_field :listing_id, value: @listing.id %>

      <div class="submit-field text-center my-3">
        <%= form.submit class: 'btn btn-primary' %>
      </div>
      <% end %>
    </div>
  </div>
</main>
